{
  "$schema": "../schema.json",
  "_schema_version": "2.0.0",
  
  "criterion_id": "MC05",
  "name": "Financial Chains",
  "description_es": "Detecta y valida cadenas presupuestales: Monto → Fuente → Programa",
  "description_en": "Detects and validates budgetary chains: Amount → Source → Program",
  
  "signal_type": "FINANCIAL_CHAIN",
  "implementation_status": "MISSING",
  "extractor_class": "FinancialChainExtractor",
  "_priority": "HIGH",
  
  "detection": {
    "primary_method": "COMPOUND_PATTERN",
    
    "components": [
      {
        "component_id": "FC-MONTO",
        "name": "monto_presupuestal",
        "description": "Monto en pesos colombianos",
        "detection": {
          "type": "REGEX",
          "patterns": [
            "\\$\\s*([\\d.,]+)\\s*(millones?|mil\\s+millones?|MM|M)?",
            "([\\d.,]+)\\s*(millones?\\s+de\\s+pesos|COP)"
          ],
          "captures": {
            "1": {"name": "valor", "type": "numeric"},
            "2": {"name": "unidad", "type": "string", "optional": true}
          }
        },
        "required": true,
        "confidence_base": 0.80
      },
      {
        "component_id": "FC-FUENTE",
        "name": "fuente_financiacion",
        "description": "Fuente de recursos",
        "detection": {
          "type": "KEYWORD_SET",
          "sets": {
            "SGP": ["SGP", "Sistema General de Participaciones", "participaciones"],
            "PROPIOS": ["recursos propios", "ingresos corrientes", "tributarios"],
            "SGR": ["SGR", "Sistema General de Regalías", "regalías"],
            "CREDITO": ["crédito", "endeudamiento", "empréstito"],
            "COFINANCIACION": ["cofinanciación", "nación", "departamento"],
            "COOPERACION": ["cooperación internacional", "donaciones"]
          }
        },
        "required": true,
        "confidence_base": 0.85
      },
      {
        "component_id": "FC-PROGRAMA",
        "name": "programa_vinculado",
        "description": "Programa o proyecto al que se asigna",
        "detection": {
          "type": "REFERENCE",
          "reference_to": "PROGRAMMATIC_HIERARCHY",
          "link_strategy": "PROXIMITY",
          "max_distance_lines": 5
        },
        "required": false,
        "confidence_bonus": 0.15
      },
      {
        "component_id": "FC-PERIODO",
        "name": "periodo_vigencia",
        "description": "Período de ejecución presupuestal",
        "detection": {
          "type": "REGEX",
          "patterns": [
            "(20[2-3]\\d)\\s*[-–]\\s*(20[2-3]\\d)",
            "vigencia\\s+(20[2-3]\\d)"
          ]
        },
        "required": false,
        "confidence_bonus": 0.10
      }
    ],
    
    "aggregation_rules": {
      "window_type": "TABLE_ROW_OR_PARAGRAPH",
      "require_minimum_components": 2,
      "require_all_required": true,
      "max_span_lines": 10
    },
    
    "table_extraction": {
      "from_ppi_table": {
        "min_confidence": 0.92,
        "conditions": "table_type=PPI AND sum_validation_pass"
      },
      "validated_closure": {
        "boost": 1.20,
        "conditions": "sum(fuentes) == PPI_total within 1%"
      }
    }
  },
  
  "validation": {
    "rules": [
      {
        "rule_id": "FC-VAL-001",
        "name": "positive_amount",
        "condition": "monto.valor > 0",
        "severity": "ERROR"
      },
      {
        "rule_id": "FC-VAL-002",
        "name": "reasonable_amount",
        "condition": "monto.valor < 1e15",
        "severity": "WARNING",
        "message": "Monto parece excesivamente alto"
      },
      {
        "rule_id": "FC-VAL-003",
        "name": "valid_period",
        "condition": "periodo.inicio <= periodo.fin",
        "severity": "ERROR"
      }
    ]
  },
  
  "scoring_impact": {
    "dimension_boost": {
      "DIM01": 0.10,
      "DIM02": 0.15,
      "DIM03": 0.20
    },
    "cross_cutting_boost": {
      "CC_SOSTENIBILIDAD_PRESUPUESTAL": 0.30
    }
  },
  
  "post_processing": {
    "normalize_currency": true,
    "aggregate_by_fuente": true,
    "link_to_ppi_table": true,
    "compute_totals": true
  },
  
  "required_capabilities": ["NUMERIC_PARSING", "FINANCIAL_ANALYSIS"],
  
  "testing": {
    "test_file": "tests/membership_criteria/test_mc05_financial.py",
    "expected_precision": 0.94,
    "expected_recall": 0.90,
    "source": "corpus_thresholds_weights.json"
  }
}
