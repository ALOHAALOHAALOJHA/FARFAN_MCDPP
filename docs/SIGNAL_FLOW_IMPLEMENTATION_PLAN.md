# Plan de Implementación: Refactorización del Flujo de Señales

Este documento actúa como un backlog vivo para la refactorización del flujo de señales, según lo descrito en los `JOBFRONTS`. Se actualizará a medida que se completen las tareas.

| ID | Componente | Archivo Principal | Prioridad | Estado Actual (Resumen) | Estado Ideal (Resumen) | Plan de Cambio |
|----|------------|-----------------|-----------|-------------------------|------------------------|----------------|
| 1 | Chunking | `src/farfan_pipeline/processing/spc_ingestion.py` | ALTA | Parámetros de chunking hardcodeados. | Chunking adaptativo basado en densidad de señales y calibración. | Modificar `StrategicChunkingSystem` para usar señales y parámetros calibrados para un chunking dinámico. |
| 2 | Executors | `src/farfan_pipeline/core/orchestrator/base_executor_with_contract.py` | CRÍTICO | Obtiene `signal_pack` básico desde el registry. | Usa `EnrichedSignalPack` para scoping, expansión, evidencia y validación por contrato. | Refactorizar el método `execute` para que utilice el flujo completo de la capa de inteligencia de `EnrichedSignalPack`. |
| 3 | Registry | `src/farfan_pipeline/core/orchestrator/factory.py` | CRÍTICO | El registry devuelve packs de señales básicos. | Una factory provee un diccionario de `EnrichedSignalPack` sin alterar el registry base. | Implementar `create_enriched_signal_registry` que envuelva los packs base en `EnrichedSignalPack`. |
| 4 | Evidence Extraction | `src/farfan_pipeline/core/orchestrator/evidence_assembler.py` | ALTA | Ensamblaje básico de evidencia. | Fusiona el ensamblaje básico con evidencia estructurada extraída desde `EnrichedSignalPack`. | Actualizar `EvidenceAssembler.assemble` para invocar `enriched_pack.extract_evidence` y fusionar los resultados. |
| 5 | Validation | `src/farfan_pipeline/core/orchestrator/evidence_validator.py` | ALTA | Solo validación de esquema (schema). | Combina validación de esquema con validación por contrato desde `EnrichedSignalPack`. | Actualizar `EvidenceValidator.validate` para que llame a `enriched_pack.validate_result` y combine los resultados. |
| 6 | Assembly | `src/farfan_pipeline/core/orchestrator/evidence_assembler.py` | MEDIA | Fusión simple de valores. | Estrategia de fusión ponderada opcional, basada en la confianza de la señal. | Añadir una nueva estrategia `signal_guided_merge` al ensamblador de evidencia. |
| 7 | Scoring | `src/farfan_pipeline/analysis/scoring.py` | MEDIA | Scoring determinístico. | Ajuste de score opcional basado en la confianza promedio de la señal. | Extender `MicroQuestionScorer` para ajustar el score utilizando la data de confianza de `EnrichedSignalPack`. |
| 8 | Aggregation | `src/farfan_pipeline/analysis/aggregation.py` | BAJA | Agregación simple (e.g., promedio). | Agregación ponderada por la completitud del resultado y la confianza de la señal. | Modificar `aggregate_micro_to_meso` para que calcule y utilice scores ponderados. |
| 9 | Reporting | `src/farfan_pipeline/analysis/report_assembly.py` | ALTA | Reporte básico sin trazabilidad de señales. | Reporte enriquecido con "provenance" de la señal (versiones, patrones, fallos de validación). | Actualizar `assemble_report` para que acepte `enriched_packs` e incluya un resumen detallado del uso de señales. |
