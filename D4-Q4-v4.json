{
  "identity": {
    "base_slot": "D4-Q4",
    "representative_question_id": "Q019",
    "dimension_id": "DIM04",
    "policy_area_ids_served": [
      "PA01",
      "PA02",
      "PA03",
      "PA04",
      "PA05",
      "PA06",
      "PA07",
      "PA08",
      "PA09",
      "PA10"
    ],
    "contracts_served": [
      "Q019",
      "Q049",
      "Q079",
      "Q109",
      "Q139",
      "Q169",
      "Q199",
      "Q229",
      "Q259",
      "Q289"
    ],
    "contract_type": "TYPE_E",
    "contract_type_name": "L√≥gico",
    "contract_type_focus": "Detecci√≥n de contradicciones y coherencia l√≥gica",
    "contract_version": "4.0.0-epistemological",
    "created_at": "2025-12-22T22:51:00Z",
    "specification_source": "OPERACIONALIZACI√ìN_CONTRATOS_VERSION_4"
  },
  "executor_binding": {
    "executor_class": "D4_Q4_Executor",
    "executor_module": "farfan_pipeline.phases.Phase_two.executors"
  },
  "method_binding": {
    "orchestration_mode": "epistemological_pipeline",
    "contract_type": "TYPE_E",
    "method_count": 6,
    "execution_phases": {
      "phase_A_construction": {
        "description": "Empirical observation layer - direct signal consumption",
        "level": "N1",
        "level_name": "Base Emp√≠rica",
        "epistemology": "Empirismo positivista",
        "methods": [],
        "dependencies": [],
        "output_target": "raw_facts",
        "note": "This contract consumes PreprocesadoMetadata directly in N2 phase"
      },
      "phase_B_computation": {
        "description": "Inferential analysis layer - logical coherence computation",
        "level": "N2",
        "level_name": "Procesamiento Inferencial",
        "epistemology": "An√°lisis l√≥gico",
        "methods": [
          {
            "class_name": "PolicyContradictionDetector",
            "method_name": "_calculate_objective_alignment",
            "mother_file": "contradiction_deteccion.py",
            "provides": "policycontradictiondetector.calculate_objective_alignment",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Calcula alineaci√≥n de objetivos entre pol√≠ticas",
            "requires": [
              "PreprocesadoMetadata"
            ],
            "modifies": [
              "alignment_scores"
            ]
          },
          {
            "class_name": "PolicyContradictionDetector",
            "method_name": "_identify_affected_sections",
            "mother_file": "contradiction_deteccion.py",
            "provides": "policycontradictiondetector.identify_affected_sections",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Identifica secciones afectadas por contradicciones",
            "requires": [
              "PreprocesadoMetadata"
            ],
            "modifies": [
              "affected_sections"
            ]
          },
          {
            "class_name": "PolicyContradictionDetector",
            "method_name": "_generate_resolution_recommendations",
            "mother_file": "contradiction_deteccion.py",
            "provides": "policycontradictiondetector.generate_resolution_recommendations",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Genera recomendaciones de resoluci√≥n de contradicciones",
            "requires": [
              "PreprocesadoMetadata"
            ],
            "modifies": [
              "resolution_recommendations"
            ]
          },
          {
            "class_name": "OperationalizationAuditor",
            "method_name": "_generate_optimal_remediations",
            "mother_file": "derek_beach.py",
            "provides": "operationalizationauditor.generate_optimal_remediations",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Genera remediaciones √≥ptimas para problemas detectados",
            "requires": [
              "PreprocesadoMetadata"
            ],
            "modifies": [
              "remediation_strategies"
            ]
          },
          {
            "class_name": "BayesianCounterfactualAuditor",
            "method_name": "aggregate_risk_and_prioritize",
            "mother_file": "bayesian_counterfactual_auditor.py",
            "provides": "bayesiancounterfactualauditor.aggregate_risk_and_prioritize",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Agrega riesgos y prioriza contradicciones",
            "requires": [
              "PreprocesadoMetadata"
            ],
            "modifies": [
              "risk_priorities"
            ]
          }
        ],
        "dependencies": [
          "PreprocesadoMetadata"
        ],
        "output_target": "inferred_parameters"
      },
      "phase_C_litigation": {
        "description": "Audit layer - allocation gap validation with veto power",
        "level": "N3",
        "level_name": "Auditor√≠a y Robustez",
        "epistemology": "Falsacionismo popperiano",
        "methods": [
          {
            "class_name": "FinancialAuditor",
            "method_name": "_detect_allocation_gaps",
            "mother_file": "financiero_viabilidad_tablas.py",
            "provides": "financialauditor.detect_allocation_gaps",
            "level": "N3-AUD",
            "output_type": "CONSTRAINT",
            "fusion_behavior": "gate",
            "description": "Detecta brechas de asignaci√≥n - puede VETAR si detecta contradicci√≥n fatal",
            "requires": [
              "PreprocesadoMetadata",
              "inferred_parameters"
            ],
            "modulates": [
              "inferred_parameters.confidence"
            ],
            "veto_conditions": {
              "critical_allocation_gap": {
                "trigger": "audit detects resource allocation contradiction",
                "action": "block_branch",
                "scope": "contradictory_allocations",
                "confidence_multiplier": 0.0
              },
              "moderate_allocation_gap": {
                "trigger": "allocation gaps detected but not critical",
                "action": "reduce_confidence",
                "scope": "allocation_mismatches",
                "confidence_multiplier": 0.5
              }
            }
          }
        ],
        "dependencies": [
          "PreprocesadoMetadata",
          "inferred_parameters"
        ],
        "output_target": "validated_constraints"
      }
    }
  },
  "question_context": {
    "monolith_ref": "Q019",
    "overrides": null,
    "failure_contract": {
      "abort_if": [
        "missing_required_element",
        "incomplete_text",
        "no_policy_data"
      ],
      "emit_code": "ABORT-Q019-REQ"
    }
  },
  "signal_requirements": {
    "required_signals": [
      "PreprocesadoMetadata",
      "policy_graph"
    ],
    "optional_signals": [
      "objective_definitions",
      "allocation_data"
    ]
  },
  "evidence_assembly": {
    "engine": "EVIDENCE_NEXUS",
    "module": "farfan_pipeline.phases.Phase_two.evidence_nexus",
    "class_name": "EvidenceNexus",
    "method_name": "assemble",
    "type_system": {
      "FACT": {
        "origin_level": "N1",
        "fusion_operation": "graph_node_addition",
        "merge_behavior": "additive",
        "symbol": "‚äï",
        "description": "Se SUMA al grafo como nodo"
      },
      "PARAMETER": {
        "origin_level": "N2",
        "fusion_operation": "edge_weight_modification",
        "merge_behavior": "multiplicative",
        "symbol": "‚äó",
        "description": "MODIFICA pesos de aristas del grafo"
      },
      "CONSTRAINT": {
        "origin_level": "N3",
        "fusion_operation": "branch_filtering",
        "merge_behavior": "gate",
        "symbol": "‚äò",
        "description": "FILTRA/BLOQUEA ramas si validaci√≥n falla"
      },
      "NARRATIVE": {
        "origin_level": "N4",
        "fusion_operation": "synthesis",
        "merge_behavior": "terminal",
        "symbol": "‚äô",
        "description": "CONSUME grafo para texto final"
      }
    },
    "assembly_rules": [
      {
        "rule_id": "R1_empirical_basis",
        "rule_type": "empirical_basis",
        "target": "prior_distribution",
        "sources": [],
        "merge_strategy": "direct_signal_consumption",
        "output_type": "FACT",
        "note": "Phase A empty - consumes PreprocesadoMetadata directly in Phase B"
      },
      {
        "rule_id": "R2_coherence_computation",
        "rule_type": "coherence_computation",
        "target": "logical_coherence",
        "sources": [
          "policycontradictiondetector.calculate_objective_alignment",
          "policycontradictiondetector.identify_affected_sections",
          "policycontradictiondetector.generate_resolution_recommendations",
          "operationalizationauditor.generate_optimal_remediations",
          "bayesiancounterfactualauditor.aggregate_risk_and_prioritize"
        ],
        "input_dependencies": [
          "PreprocesadoMetadata"
        ],
        "merge_strategy": "weighted_mean",
        "output_type": "PARAMETER"
      },
      {
        "rule_id": "R3_allocation_validation_gate",
        "rule_type": "allocation_validation_gate",
        "target": "validated_coherence",
        "sources": [
          "financialauditor.detect_allocation_gaps"
        ],
        "input_dependencies": [
          "logical_coherence"
        ],
        "merge_strategy": "veto_gate",
        "gate_logic": {
          "critical_allocation_gap": {
            "action": "block_branch",
            "multiplier": 0.0
          },
          "moderate_allocation_gap": {
            "action": "reduce_confidence",
            "multiplier": 0.5
          }
        },
        "output_type": "CONSTRAINT"
      },
      {
        "rule_id": "R4_synthesis",
        "rule_type": "synthesis",
        "target": "human_answer",
        "sources": [],
        "input_dependencies": [
          "validated_coherence"
        ],
        "merge_strategy": "carver_doctoral_synthesis",
        "output_type": "NARRATIVE"
      }
    ]
  },
  "fusion_specification": {
    "contract_type": "TYPE_E",
    "primary_strategy": "weighted_mean",
    "level_strategies": {
      "N1_fact_fusion": {
        "strategy": "direct_signal_consumption",
        "behavior": "pass_through",
        "note": "No N1 methods - PreprocesadoMetadata consumed directly by N2"
      },
      "N2_parameter_fusion": {
        "strategy": "weighted_mean",
        "behavior": "multiplicative",
        "conflict_resolution": "weighted_voting",
        "affects": [
          "coherence_scores",
          "alignment_scores",
          "resolution_recommendations"
        ],
        "formula": {
          "description": "Weighted mean of logical coherence scores",
          "operation": "coherence_combined = Œ£(weight_i √ó coherence_i) / Œ£(weight_i)"
        }
      },
      "N3_constraint_fusion": {
        "strategy": "veto_gate",
        "behavior": "gate",
        "asymmetry_principle": "audit_dominates",
        "propagation": {
          "upstream": "confidence_backpropagation",
          "downstream": "branch_blocking"
        }
      }
    },
    "cross_layer_effects": {
      "N2_modifies_N1_confidence": false,
      "N3_can_veto_N1_N2": true,
      "N1_N2_cannot_veto_N3": true,
      "note": "N2 operates directly on PreprocesadoMetadata"
    },
    "fusion_pipeline": {
      "stage_1_fact_accumulation": {
        "input": "PreprocesadoMetadata",
        "operation": "PASS PreprocesadoMetadata to N2",
        "output": "evidence_graph_v1",
        "type_consumed": "SIGNAL",
        "behavior": "pass_through"
      },
      "stage_2_parameter_application": {
        "input": [
          "PreprocesadoMetadata",
          "phase_B_computation.outputs"
        ],
        "operation": "COMPUTE logical coherence via weighted mean",
        "output": "evidence_graph_v2_weighted",
        "type_consumed": "PARAMETER",
        "behavior": "multiplicative"
      },
      "stage_3_constraint_filtering": {
        "input": [
          "evidence_graph_v2_weighted",
          "phase_C_litigation.outputs"
        ],
        "operation": "VALIDATE allocation gaps - VETO if critical",
        "output": "evidence_graph_v3_validated",
        "type_consumed": "CONSTRAINT",
        "behavior": "gate",
        "blocking_log": "audit_results.blocked_branches"
      },
      "stage_4_synthesis": {
        "input": "evidence_graph_v3_validated",
        "operation": "GENERATE narrative from validated coherence analysis",
        "output": "human_answer",
        "type_produced": "NARRATIVE"
      }
    }
  },
  "cross_layer_fusion": {
    "N1_to_N2": {
      "relationship": "N2 reads PreprocesadoMetadata directly",
      "effect": "N2 computes coherence analysis FROM raw signals",
      "data_flow": "forward_propagation",
      "note": "No N1 intermediary - direct signal consumption"
    },
    "N2_to_N1": {
      "relationship": "Not applicable",
      "effect": "N2 does not backpropagate to N1 (no N1 layer)",
      "data_flow": "none"
    },
    "N3_to_N2": {
      "relationship": "N3 can INVALIDATE N2 parameters",
      "effect": "Failed allocation audit nullifies coherence scores",
      "data_flow": "inference_modulation",
      "asymmetry": "N2 CANNOT invalidate N3"
    },
    "all_to_N4": {
      "relationship": "N4 consumes validated outputs from N2 and N3",
      "effect": "Synthesis constructs narrative from validated coherence",
      "data_flow": "terminal_aggregation"
    },
    "blocking_propagation_rules": {
      "critical_allocation_gap": {
        "triggered_by": "FinancialAuditor._detect_allocation_gaps",
        "action": "block_branch",
        "scope": "contradictory_allocations",
        "propagation": "total"
      },
      "moderate_allocation_gap": {
        "triggered_by": "FinancialAuditor._detect_allocation_gaps",
        "action": "reduce_confidence",
        "scope": "allocation_mismatches",
        "propagation": "downstream_only",
        "confidence_multiplier": 0.5
      }
    }
  },
  "human_answer_structure": {
    "format": "markdown",
    "template_mode": "epistemological_narrative",
    "contract_type": "TYPE_E",
    "sections": [
      {
        "section_id": "S1_verdict",
        "title": "### Veredicto",
        "layer": "N4",
        "data_source": "synthesis_output",
        "narrative_style": "declarative",
        "argumentative_role": "SYNTHESIS",
        "template": {
          "structure": [
            "**Conclusi√≥n**: {verdict_statement}",
            "",
            "**Confianza Global**: {final_confidence_pct}% ({confidence_label})",
            "",
            "**Base Metodol√≥gica**: {method_count} m√©todos ejecutados, {audit_count} validaciones, {blocked_count} ramas bloqueadas."
          ]
        }
      },
      {
        "section_id": "S2_empirical_base",
        "title": "### Base Emp√≠rica: Elementos L√≥gicos",
        "layer": "N2",
        "data_source": "inferred_parameters",
        "narrative_style": "descriptive",
        "argumentative_role": "INFERENTIAL_BRIDGE",
        "note": "No N1 layer - showing N2 coherence computations as base",
        "template": {
          "structure": [
            "**Contradicciones Detectadas**: {contradiction_count}",
            "{contradictions_list}",
            "",
            "**Coherencia L√≥gica**: {logical_coherence_score}%",
            "",
            "**Alineaci√≥n de Objetivos**: {objective_alignment_pct}%"
          ]
        },
        "epistemological_note": {
          "include_in_output": true,
          "text": "üìã *Nota: An√°lisis l√≥gico basado en documento fuente.*"
        }
      },
      {
        "section_id": "S3_robustness_audit",
        "title": "### An√°lisis de Robustez: Validaci√≥n de Asignaci√≥n",
        "layer": "N3",
        "data_source": "audit_results",
        "narrative_style": "critical",
        "argumentative_role": "ROBUSTNESS_QUALIFIER",
        "veto_display": {
          "if_veto_triggered": "‚õî **MODELO INV√ÅLIDO**: {veto_reason}. NO usar para toma de decisiones.",
          "if_partial_veto": "‚ö†Ô∏è **ROBUSTEZ PARCIAL**: {partial_veto_count} hallazgos invalidados.",
          "if_no_veto": "‚úÖ **VALIDACI√ìN COMPLETA**: Todos los hallazgos sobrevivieron refutaci√≥n."
        },
        "template": {
          "structure": [
            "{veto_alert}",
            "",
            "**Validaciones Ejecutadas**: {validation_count}",
            "",
            "**Brechas de Asignaci√≥n**: {allocation_gaps_count}",
            "",
            "**An√°lisis de Robustez**: {robustness_assessment}",
            "",
            "**Limitaciones Metodol√≥gicas**:",
            "{limitations_list}"
          ]
        },
        "epistemological_note": {
          "include_in_output": true,
          "text": "üî¨ *Nota: Falsacionismo popperiano aplicado.*"
        }
      },
      {
        "section_id": "S4_gaps",
        "title": "### Puntos Ciegos: Contradicciones No Detectadas",
        "layer": "N4-META",
        "data_source": "gap_analysis",
        "narrative_style": "diagnostic",
        "argumentative_role": "META_TRACEABILITY",
        "template": {
          "structure": [
            "**M√©todos sin Resultados**: {empty_methods_count} de {total_methods}",
            "{empty_methods_details}",
            "",
            "**Impacto en Confianza**:",
            "{gap_impact_assessment}"
          ]
        }
      }
    ],
    "argumentative_roles": {
      "N1_roles": [],
      "N2_roles": [
        {
          "role": "INFERENTIAL_BRIDGE",
          "description": "Detecci√≥n de incompatibilidades y c√°lculo de coherencia",
          "narrative_weight": "high"
        }
      ],
      "N3_roles": [
        {
          "role": "ROBUSTNESS_QUALIFIER",
          "description": "Validaci√≥n de brechas de asignaci√≥n",
          "narrative_weight": "critical"
        },
        {
          "role": "REFUTATIONAL_SIGNAL",
          "description": "Detecci√≥n de contradicciones de asignaci√≥n",
          "narrative_weight": "critical"
        }
      ],
      "N4_roles": [
        {
          "role": "META_TRACEABILITY",
          "description": "Completitud de detecci√≥n de contradicciones",
          "narrative_weight": "medium"
        }
      ]
    },
    "confidence_interpretation": {
      "critical": {
        "range": [
          0,
          19
        ],
        "label": "INV√ÅLIDO",
        "description": "Veto activado por contradicci√≥n de asignaci√≥n cr√≠tica.",
        "display": "üî¥"
      },
      "low": {
        "range": [
          20,
          49
        ],
        "label": "D√âBIL",
        "description": "Brechas de asignaci√≥n moderadas detectadas.",
        "display": "üü†"
      },
      "medium": {
        "range": [
          50,
          79
        ],
        "label": "MODERADO",
        "description": "Coherencia l√≥gica con limitaciones menores.",
        "display": "üü°"
      },
      "high": {
        "range": [
          80,
          100
        ],
        "label": "ROBUSTO",
        "description": "Coherencia l√≥gica validada sin contradicciones.",
        "display": "üü¢"
      }
    }
  },
  "output_contract": {
    "result_type": "Phase2QuestionResult",
    "schema": {
      "type": "object",
      "required": [
        "base_slot",
        "question_id",
        "evidence",
        "score",
        "human_answer"
      ],
      "properties": {
        "base_slot": {
          "type": "string",
          "const": "D4-Q4"
        },
        "question_id": {
          "type": "string",
          "pattern": "^Q(019|049|079|109|139|169|199|229|259|289)$"
        },
        "evidence": {
          "type": "object"
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "human_answer": {
          "type": "string"
        }
      }
    }
  },
  "validation_rules": {
    "method_count_integrity": {
      "rule": "Sum of methods in phases A, B, C must equal method_count",
      "check": "phase_A.length + phase_B.length + phase_C.length == method_count",
      "expected": "0 + 5 + 1 = 6"
    },
    "provides_sources_consistency": {
      "rule": "All 'provides' in methods must appear in assembly_rules 'sources'",
      "check": "For each method.provides, exists assembly_rule with that source"
    },
    "no_spaces_in_identifiers": {
      "rule": "No spaces in provides, sources, module paths",
      "check": "All identifiers use underscores or dots only"
    },
    "n3_veto_conditions": {
      "rule": "All N3 methods must have veto_conditions defined",
      "check": "phase_C methods have veto_conditions object"
    },
    "contract_type_alignment": {
      "rule": "contract_type must match primary_strategy",
      "check": "TYPE_E matches weighted_mean strategy"
    },
    "epistemological_consistency": {
      "rule": "Method levels must match phase assignments",
      "check": "N1 methods only in phase_A, N2 in phase_B, N3 in phase_C"
    }
  },
  "error_handling": {
    "missing_signal": {
      "strategy": "abort",
      "message": "Required signal PreprocesadoMetadata missing",
      "emit_code": "ERROR-D4-Q4-SIGNAL"
    },
    "method_execution_failure": {
      "strategy": "partial_result",
      "message": "Method {method_name} failed - continuing with reduced confidence",
      "confidence_penalty": 0.15
    },
    "veto_triggered": {
      "strategy": "block_result",
      "message": "Audit veto triggered: {veto_reason}",
      "emit_code": "VETO-D4-Q4-AUDIT"
    }
  },
  "traceability": {
    "audit_trail": true,
    "method_execution_log": true,
    "confidence_backpropagation_log": true,
    "veto_decision_log": true
  },
  "compatibility": {
    "min_pipeline_version": "4.0.0",
    "phase_two_executor_version": "4.0.0",
    "evidence_nexus_version": "4.0.0"
  },
  "calibration": {
    "default_method_weight": 1.0,
    "confidence_floor": 0.0,
    "confidence_ceiling": 1.0,
    "veto_confidence_override": 0.0
  }
}
