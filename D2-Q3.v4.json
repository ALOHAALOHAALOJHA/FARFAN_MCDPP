{
  "identity": {
    "base_slot": "D2-Q3",
    "representative_question_id": "Q008",
    "dimension_id": "DIM02",
    "policy_area_ids_served": ["PA01", "PA02", "PA03", "PA04", "PA05", "PA06", "PA07", "PA08", "PA09", "PA10"],
    "contracts_served": ["Q008", "Q038", "Q068", "Q098", "Q128", "Q158", "Q188", "Q218", "Q248", "Q278"],
    "contract_type": "TYPE_C",
    "contract_type_name": "Causal",
    "contract_type_focus": "Topolog√≠a de grafos, cadenas causales, DAGs",
    "contract_version": "4.0.0-epistemological",
    "created_at": "2025-12-22T18:20:00Z",
    "specification_source": "guia_diligenciamiento_contratos_v4.md"
  },

  "executor_binding": {
    "executor_class": "D2_Q3_Executor",
    "executor_module": "farfan_pipeline.phases.Phase_two.executors"
  },

  "method_binding": {
    "orchestration_mode": "epistemological_pipeline",
    "contract_type": "TYPE_C",
    "method_count": 9,
    "execution_phases": {
      "phase_A_construction": {
        "description": "Empirical observation layer - direct signal consumption",
        "level": "N1",
        "level_name": "Base Emp√≠rica",
        "epistemology": "Empirismo positivista",
        "methods": [],
        "dependencies": [],
        "output_target": "raw_facts",
        "note": "This contract consumes PreprocesadoMetadata directly in N2 phase - no N1 extraction needed"
      },

      "phase_B_computation": {
        "description": "Inferential analysis layer - causal graph construction and edge inference",
        "level": "N2",
        "level_name": "Procesamiento Inferencial",
        "epistemology": "Bayesianismo subjetivista",
        "methods": [
          {
            "class_name": "CausalExtractor",
            "method_name": "_extract_causal_links",
            "mother_file": "derek_beach.py",
            "provides": "causalextractor.extract_causal_links",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Extrae enlaces causales del texto con probabilidades",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["causal_link_probabilities"]
          },
          {
            "class_name": "CausalExtractor",
            "method_name": "_calculate_composite_likelihood",
            "mother_file": "derek_beach.py",
            "provides": "causalextractor.calculate_composite_likelihood",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Calcula likelihood compuesta de relaciones causales",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["composite_likelihood_scores"]
          },
          {
            "class_name": "CausalExtractor",
            "method_name": "_initialize_prior",
            "mother_file": "derek_beach.py",
            "provides": "causalextractor.initialize_prior",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Inicializa distribuci√≥n prior para inferencia causal",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["prior_distributions"]
          },
          {
            "class_name": "CausalExtractor",
            "method_name": "_calculate_type_transition_prior",
            "mother_file": "derek_beach.py",
            "provides": "causalextractor.calculate_type_transition_prior",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Calcula priors de transici√≥n entre tipos causales",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["transition_prior_scores"]
          },
          {
            "class_name": "PDETMunicipalPlanAnalyzer",
            "method_name": "_identify_causal_edges",
            "mother_file": "financiero_viabilidad_tablas.py",
            "provides": "pdetmunicipalplananalyzer.identify_causal_edges",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Identifica aristas causales en el grafo con scoring",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["edge_identification_scores"]
          },
          {
            "class_name": "PDETMunicipalPlanAnalyzer",
            "method_name": "_refine_edge_probabilities",
            "mother_file": "financiero_viabilidad_tablas.py",
            "provides": "pdetmunicipalplananalyzer.refine_edge_probabilities",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Refina probabilidades de aristas causales",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["refined_edge_probabilities"]
          },
          {
            "class_name": "BayesianCounterfactualAuditor",
            "method_name": "_create_default_equations",
            "mother_file": "derek_beach.py",
            "provides": "bayesiancounterfactualauditor.create_default_equations",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Crea ecuaciones estructurales default para SCM",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["scm_equation_scores"]
          },
          {
            "class_name": "SemanticAnalyzer",
            "method_name": "extract_semantic_cube",
            "mother_file": "analyzer_one.py",
            "provides": "semanticanalyzer.extract_semantic_cube",
            "level": "N2-INF",
            "output_type": "PARAMETER",
            "fusion_behavior": "multiplicative",
            "description": "Extrae cubo sem√°ntico para an√°lisis dimensional de causalidad",
            "requires": ["PreprocesadoMetadata"],
            "modifies": ["semantic_dimension_scores"]
          }
        ],
        "dependencies": ["PreprocesadoMetadata"],
        "output_target": "inferred_parameters"
      },

      "phase_C_litigation": {
        "description": "Audit layer - validation of causal graph structure via SCM construction",
        "level": "N3",
        "level_name": "Auditor√≠a y Robustez",
        "epistemology": "Falsacionismo popperiano",
        "methods": [
          {
            "class_name": "BayesianCounterfactualAuditor",
            "method_name": "construct_scm",
            "mother_file": "derek_beach.py",
            "provides": "bayesiancounterfactualauditor.construct_scm",
            "level": "N3-AUD",
            "output_type": "CONSTRAINT",
            "fusion_behavior": "gate",
            "description": "Construye Structural Causal Model - falla si grafo es inv√°lido",
            "requires": ["PreprocesadoMetadata", "inferred_parameters"],
            "modulates": ["inferred_parameters.confidence"],
            "veto_conditions": {
              "scm_construction_failed": {
                "trigger": "construct_scm raises exception or returns invalid SCM",
                "action": "block_branch",
                "scope": "entire_causal_graph",
                "confidence_multiplier": 0.0
              },
              "cyclic_dependencies_detected": {
                "trigger": "SCM construction detects cycles in causal graph",
                "action": "invalidate_graph",
                "scope": "circular_dependency_chains",
                "confidence_multiplier": 0.0
              },
              "structural_equations_invalid": {
                "trigger": "default equations cannot be constructed for all nodes",
                "action": "block_branch",
                "scope": "nodes_without_valid_equations",
                "confidence_multiplier": 0.3
              }
            }
          }
        ],
        "dependencies": ["PreprocesadoMetadata", "inferred_parameters"],
        "output_target": "validated_constraints"
      }
    }
  },

  "question_context": {
    "monolith_ref": "Q008",
    "overrides": null,
    "failure_contract": {
      "abort_if": ["missing_required_element", "incomplete_text", "no_causal_structure"],
      "emit_code": "ABORT-D2-Q3-REQ"
    }
  },

  "signal_requirements": {
    "required_signals": ["PreprocesadoMetadata", "causal_graph"],
    "optional_signals": ["causal_priors", "transition_matrices"]
  },

  "evidence_assembly": {
    "engine": "EVIDENCE_NEXUS",
    "module": "farfan_pipeline.phases.Phase_two.evidence_nexus",
    "class_name": "EvidenceNexus",
    "method_name": "assemble",
    "type_system": {
      "FACT": {
        "origin_level": "N1",
        "fusion_operation": "graph_node_addition",
        "merge_behavior": "additive",
        "symbol": "‚äï",
        "description": "Se SUMA al grafo como nodo"
      },
      "PARAMETER": {
        "origin_level": "N2",
        "fusion_operation": "edge_weight_modification",
        "merge_behavior": "multiplicative",
        "symbol": "‚äó",
        "description": "MODIFICA pesos de aristas del grafo"
      },
      "CONSTRAINT": {
        "origin_level": "N3",
        "fusion_operation": "branch_filtering",
        "merge_behavior": "gate",
        "symbol": "‚äò",
        "description": "FILTRA/BLOQUEA ramas si validaci√≥n falla"
      },
      "NARRATIVE": {
        "origin_level": "N4",
        "fusion_operation": "synthesis",
        "merge_behavior": "terminal",
        "symbol": "‚äô",
        "description": "CONSUME grafo para texto final"
      }
    },
    "assembly_rules": [
      {
        "rule_id": "R1_structure_definition",
        "rule_type": "structure_definition",
        "target": "causal_graph",
        "sources": [],
        "merge_strategy": "direct_signal_consumption",
        "output_type": "FACT",
        "note": "Phase A empty - consumes PreprocesadoMetadata directly in Phase B"
      },
      {
        "rule_id": "R2_edge_inference",
        "rule_type": "edge_inference",
        "target": "weighted_causal_graph",
        "sources": [
          "causalextractor.extract_causal_links",
          "causalextractor.calculate_composite_likelihood",
          "causalextractor.initialize_prior",
          "causalextractor.calculate_type_transition_prior",
          "pdetmunicipalplananalyzer.identify_causal_edges",
          "pdetmunicipalplananalyzer.refine_edge_probabilities",
          "bayesiancounterfactualauditor.create_default_equations",
          "semanticanalyzer.extract_semantic_cube"
        ],
        "input_dependencies": ["PreprocesadoMetadata"],
        "merge_strategy": "topological_overlay",
        "operation": "if multiple methods identify same edge ‚Üí merge with topological consistency check",
        "output_type": "PARAMETER"
      },
      {
        "rule_id": "R3_validity_check",
        "rule_type": "validity_check",
        "target": "validated_graph",
        "sources": [
          "bayesiancounterfactualauditor.construct_scm"
        ],
        "input_dependencies": ["weighted_causal_graph"],
        "merge_strategy": "veto_gate",
        "gate_logic": {
          "scm_construction_failed": {
            "action": "invalidate_graph",
            "multiplier": 0.0
          },
          "cyclic_dependencies_detected": {
            "action": "invalidate_graph",
            "multiplier": 0.0
          },
          "structural_equations_invalid": {
            "action": "block_branch",
            "scope": "nodes_without_valid_equations",
            "multiplier": 0.3
          }
        },
        "output_type": "CONSTRAINT"
      },
      {
        "rule_id": "R4_synthesis",
        "rule_type": "synthesis",
        "target": "human_answer",
        "sources": [],
        "input_dependencies": ["validated_graph"],
        "merge_strategy": "carver_doctoral_synthesis",
        "output_type": "NARRATIVE"
      }
    ]
  },

  "fusion_specification": {
    "contract_type": "TYPE_C",
    "primary_strategy": "topological_overlay",
    "level_strategies": {
      "N1_fact_fusion": {
        "strategy": "direct_signal_consumption",
        "behavior": "pass_through",
        "note": "No N1 methods - PreprocesadoMetadata consumed directly by N2"
      },
      "N2_parameter_fusion": {
        "strategy": "topological_overlay",
        "behavior": "multiplicative",
        "conflict_resolution": "topological_consistency_check",
        "affects": ["edge_weights", "node_probabilities"],
        "formula": {
          "description": "Overlay edge inferences checking for topological consistency",
          "operation": "if TeoriaCambio path AND CausalExtractor path ‚Üí check for cycles"
        }
      },
      "N3_constraint_fusion": {
        "strategy": "veto_gate",
        "behavior": "gate",
        "asymmetry_principle": "audit_dominates",
        "propagation": {
          "upstream": "confidence_backpropagation",
          "downstream": "branch_blocking"
        }
      }
    },
    "cross_layer_effects": {
      "N2_modifies_N1_confidence": false,
      "N3_can_veto_N1_N2": true,
      "N1_N2_cannot_veto_N3": true,
      "note": "N2 operates directly on PreprocesadoMetadata"
    },
    "fusion_pipeline": {
      "stage_1_fact_accumulation": {
        "input": "PreprocesadoMetadata",
        "operation": "PASS PreprocesadoMetadata to N2",
        "output": "evidence_graph_v1",
        "type_consumed": "SIGNAL",
        "behavior": "pass_through"
      },
      "stage_2_parameter_application": {
        "input": ["PreprocesadoMetadata", "phase_B_computation.outputs"],
        "operation": "CONSTRUCT causal graph with weighted edges via topological overlay",
        "output": "evidence_graph_v2_weighted",
        "type_consumed": "PARAMETER",
        "behavior": "multiplicative"
      },
      "stage_3_constraint_filtering": {
        "input": ["evidence_graph_v2_weighted", "phase_C_litigation.outputs"],
        "operation": "VALIDATE causal graph via SCM construction - VETO if invalid",
        "output": "evidence_graph_v3_validated",
        "type_consumed": "CONSTRAINT",
        "behavior": "gate",
        "blocking_log": "audit_results.blocked_branches"
      },
      "stage_4_synthesis": {
        "input": "evidence_graph_v3_validated",
        "operation": "GENERATE narrative from validated causal graph",
        "output": "human_answer",
        "type_produced": "NARRATIVE"
      }
    }
  },

  "cross_layer_fusion": {
    "N1_to_N2": {
      "relationship": "N2 reads PreprocesadoMetadata directly",
      "effect": "N2 constructs causal graph FROM raw signals",
      "data_flow": "forward_propagation",
      "note": "No N1 intermediary - direct signal consumption"
    },
    "N2_to_N1": {
      "relationship": "Not applicable",
      "effect": "N2 does not backpropagate to N1 (no N1 layer)",
      "data_flow": "none"
    },
    "N3_to_N2": {
      "relationship": "N3 can INVALIDATE N2 parameters",
      "effect": "Failed SCM construction nullifies entire causal graph",
      "data_flow": "inference_modulation",
      "asymmetry": "N2 CANNOT invalidate N3"
    },
    "all_to_N4": {
      "relationship": "N4 consumes validated outputs from N2 and N3",
      "effect": "Synthesis constructs narrative from validated causal graph",
      "data_flow": "terminal_aggregation"
    },
    "blocking_propagation_rules": {
      "scm_construction_failed": {
        "triggered_by": "BayesianCounterfactualAuditor.construct_scm",
        "action": "invalidate_graph",
        "scope": "entire_causal_graph",
        "propagation": "total"
      },
      "cyclic_dependencies": {
        "triggered_by": "BayesianCounterfactualAuditor.construct_scm",
        "action": "invalidate_graph",
        "scope": "circular_dependency_chains",
        "propagation": "total"
      },
      "invalid_equations": {
        "triggered_by": "BayesianCounterfactualAuditor.construct_scm",
        "action": "block_branch",
        "scope": "nodes_without_valid_equations",
        "propagation": "downstream_only",
        "confidence_multiplier": 0.3
      }
    }
  },

  "human_answer_structure": {
    "format": "markdown",
    "template_mode": "epistemological_narrative",
    "contract_type": "TYPE_C",
    "sections": [
      {
        "section_id": "S1_verdict",
        "title": "### Veredicto",
        "layer": "N4",
        "data_source": "synthesis_output",
        "narrative_style": "declarative",
        "argumentative_role": "SYNTHESIS"
      },
      {
        "section_id": "S2_empirical_base",
        "title": "### Base Emp√≠rica: Grafo Causal Inferido",
        "layer": "N2",
        "data_source": "inferred_parameters",
        "narrative_style": "descriptive",
        "argumentative_role": "INFERENTIAL_BRIDGE",
        "note": "No N1 layer - showing N2 causal graph construction as base"
      },
      {
        "section_id": "S3_robustness_audit",
        "title": "### An√°lisis de Robustez: Validaci√≥n Topol√≥gica",
        "layer": "N3",
        "data_source": "audit_results",
        "narrative_style": "critical",
        "argumentative_role": "ROBUSTNESS_QUALIFIER",
        "veto_display": {
          "if_veto_triggered": "‚õî ALERTA CR√çTICA: {veto_reason}. El grafo causal es INV√ÅLIDO t√©cnicamente.",
          "if_no_veto": "‚úÖ Grafo causal topol√≥gicamente v√°lido (DAG ac√≠clico confirmado)."
        }
      },
      {
        "section_id": "S4_gaps",
        "title": "### Puntos Ciegos: Enlaces Causales Faltantes",
        "layer": "N4-META",
        "data_source": "gap_analysis",
        "narrative_style": "diagnostic",
        "argumentative_role": "META_TRACEABILITY"
      }
    ],
    "argumentative_roles": {
      "N1_roles": [],
      "N2_roles": [
        {
          "role": "INFERENTIAL_BRIDGE",
          "description": "Enlace causal inferido con probabilidad",
          "narrative_weight": "high"
        }
      ],
      "N3_roles": [
        {
          "role": "ROBUSTNESS_QUALIFIER",
          "description": "Validaci√≥n de estructura causal via SCM",
          "narrative_weight": "critical"
        },
        {
          "role": "REFUTATIONAL_SIGNAL",
          "description": "Detecci√≥n de ciclos o inconsistencias topol√≥gicas",
          "narrative_weight": "critical"
        }
      ],
      "N4_roles": [
        {
          "role": "META_TRACEABILITY",
          "description": "Completitud de grafo causal",
          "narrative_weight": "medium"
        }
      ]
    },
    "confidence_interpretation": {
      "critical": {
        "range": [0, 19],
        "label": "INV√ÅLIDO",
        "description": "Veto activado por grafo causal inv√°lido (ciclos detectados o SCM no construible).",
        "display": "üî¥"
      },
      "low": {
        "range": [20, 49],
        "label": "D√âBIL",
        "description": "Grafo causal con ecuaciones estructurales incompletas.",
        "display": "üü†"
      },
      "medium": {
        "range": [50, 79],
        "label": "MODERADO",
        "description": "Grafo causal v√°lido con limitaciones en inferencia de aristas.",
        "display": "üü°"
      },
      "high": {
        "range": [80, 100],
        "label": "ROBUSTO",
        "description": "DAG ac√≠clico con SCM completo y validado.",
        "display": "üü¢"
      }
    }
  },

  "output_contract": {
    "result_type": "Phase2QuestionResult",
    "schema": {
      "type": "object",
      "required": ["base_slot", "question_id", "evidence", "score", "human_answer"],
      "properties": {
        "base_slot": {"type": "string", "const": "D2-Q3"},
        "question_id": {"type": "string"},
        "dimension_id": {"type": "string"},
        "policy_area_id": {"type": "string"},
        "score": {"type": "number", "minimum": 0, "maximum": 1},
        "confidence_label": {"type": "string", "enum": ["INV√ÅLIDO", "D√âBIL", "MODERADO", "ROBUSTO"]},
        "evidence": {"type": "object"},
        "human_answer": {"type": "string"},
        "epistemological_trace": {
          "type": "object",
          "properties": {
            "n1_facts_count": {"type": "number"},
            "n2_inferences_count": {"type": "number"},
            "n3_validations_count": {"type": "number"},
            "veto_triggered": {"type": "boolean"},
            "blocked_branches": {"type": "array"}
          }
        }
      }
    }
  },

  "validation_rules": {
    "na_policy": "abort_on_critical",
    "derivation_source": "expected_elements",
    "engine": "VALIDATION_ENGINE",
    "module": "farfan_pipeline.phases.Phase_two.evidence_nexus",
    "class_name": "ValidationEngine",
    "method_name": "validate"
  },

  "error_handling": {
    "on_method_not_found": "raise",
    "on_method_failure": "propagate_with_trace",
    "on_assembly_failure": "propagate_with_trace",
    "failure_contract": {
      "abort_if": ["missing_required_element", "incomplete_text"],
      "emit_code": "ABORT-D2-Q3-REQ"
    }
  },

  "traceability": {
    "canonical_sources": {
      "questionnaire": "canonic_questionnaire_central/questionnaire_monolith.json",
      "method_classification": "method_classification_all_30.json",
      "epistemological_guide": "OPERACIONALIZACI√ìN_CONTRATOS_VERSION_4"
    },
    "generation": {
      "method": "v4_epistemological_generation",
      "timestamp": "2025-12-22T18:20:00Z",
      "generator_version": "1.0.0",
      "notes": "Contract with no N1 methods - N2 consumes PreprocesadoMetadata directly for causal graph construction. SCM construction acts as critical veto gate."
    }
  },

  "compatibility": {
    "questionnaire_monolith_version": "3.0.0",
    "version_detection": "runtime",
    "minimum_requirements": {
      "signal_registry": "MicroAnsweringSignalPack support",
      "hydrator": "ContractHydrator v1.0.0",
      "carver": "DoctoralCarverSynthesizer v3.0.0",
      "evidence_nexus": "EvidenceNexus v2.0.0"
    }
  },

  "calibration": {
    "status": "runtime",
    "sources": {
      "intrinsic_calibration": "config/intrinsic_calibration.json",
      "fusion_specification": "config/fusion_specification.json"
    }
  }
}
