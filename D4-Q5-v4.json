{
  "identity": {
    "contract_id": "D4-Q5-v4",
    "contract_version": "4.0.0",
    "created_at": "2025-12-22T21:54:00Z",
    "question_id": "Q020",
    "contract_type": "TYPE_D",
    "primary_strategy": "weighted_mean"
  },
  "executor_binding": {
    "executor_class": "D1_Q2_Executor",
    "executor_module": "farfan_pipeline. phases.Phase_two. executors"
  },
  "method_binding": {
    "method_count": 8,
    "execution_phases": {
      "phase_A_construction": {
        "methods": [],
        "output_type": "FACT"
      },
      "phase_B_computation": {
        "methods": [],
        "output_type": "PARAMETER"
      },
      "phase_C_litigation": {
        "methods": [],
        "output_type": "CONSTRAINT"
      }
    }
  },
  "question_context": {
    "monolith_ref": "Q020"
  },
  "signal_requirements": {
    "derivation_source": "expected_elements",
    "derivation_rules": {
      "mandatory": "expected_elements[required=true]. type \u2192 detection_{type}",
      "optional": "expected_elements[required=false].type \u2192 detection_{type}"
    },
    "signal_aggregation": "weighted_mean",
    "minimum_signal_threshold": 0.5
  },
  "evidence_assembly": {
    "engine": "EVIDENCE_NEXUS",
    "module": "farfan_pipeline.phases. Phase_two.evidence_nexus",
    "class_name": "EvidenceNexus",
    "method_name": "assemble",
    "type_system": {
      "FACT": {
        "origin_level": "N1",
        "fusion_operation": "graph_node_addition",
        "merge_behavior": "additive",
        "symbol": "\u2295"
      },
      "PARAMETER": {
        "origin_level": "N2",
        "fusion_operation": "edge_weight_modification",
        "merge_behavior": "multiplicative",
        "symbol": "\u2297"
      },
      "CONSTRAINT": {
        "origin_level": "N3",
        "fusion_operation": "branch_filtering",
        "merge_behavior": "gate",
        "symbol": "\u2298"
      },
      "NARRATIVE": {
        "origin_level": "N4",
        "fusion_operation": "synthesis",
        "merge_behavior": "terminal",
        "symbol": "\u2299"
      }
    },
    "assembly_rules": [
      {
        "rule_id": "R1_empirical_extraction",
        "rule_type": "empirical_basis",
        "target": "raw_facts",
        "sources": [
          "bayesianmechanisminference.detect_gaps",
          "pdetmunicipalplananalyzer.generate_optimal_remediations"
        ],
        "merge_strategy": "concat_with_deduplication",
        "deduplication_key": "element_id",
        "output_type": "FACT",
        "confidence_propagation": "preserve_individual"
      },
      {
        "rule_id": "R2_bayesian_update",
        "rule_type": "probabilistic_update",
        "target": "posterior_belief",
        "sources": [
          "operationalizationauditor.audit_direct_evidence",
          "operationalizationauditor.audit_systemic_risk",
          "pdetmunicipalplananalyzer.simulate_intervention",
          "bayesiancounterfactualauditor.test_effect_stability",
          "policycontradictiondetector.detect_numerical_inconsistencies",
          "policycontradictiondetector.calculate_numerical_divergence",
          "bayesianconfidencecalculator.calculate_posterior"
        ],
        "input_dependencies": [
          "raw_facts"
        ],
        "merge_strategy": "bayesian_update",
        "operation": {
          "description": "posterior = update_belief(prior, likelihood_from_evidence)",
          "prior_source": "raw_facts",
          "likelihood_source": "inferences"
        },
        "output_type": "PARAMETER",
        "confidence_propagation": "conservative_bayesian"
      },
      {
        "rule_id": "R3_audit_gate",
        "rule_type": "robustness_gate",
        "target": "validated_posterior",
        "sources": [
          "financialauditor.detect_allocation_gaps",
          "bayesiancounterfactualauditor.counterfactual_query",
          "performanceanalyzer.analyze_performance"
        ],
        "input_dependencies": [
          "raw_facts",
          "posterior_belief"
        ],
        "merge_strategy": "veto_gate",
        "output_type": "CONSTRAINT",
        "gate_logic": {
          "allocation_gap_critical": {
            "action": "reduce_confidence",
            "confidence_multiplier": 0.3,
            "scope": "affected_goals"
          },
          "counterfactual_failed": {
            "action": "block_branch",
            "confidence_multiplier": 0.0,
            "scope": "causal_claims"
          },
          "performance_low": {
            "action": "flag_caution",
            "confidence_multiplier": 0.7,
            "scope": "all_inferences"
          }
        }
      },
      {
        "rule_id": "R4_narrative_synthesis",
        "rule_type": "synthesis",
        "target": "human_answer",
        "sources": [],
        "input_dependencies": [
          "validated_posterior",
          "audit_results"
        ],
        "merge_strategy": "carver_doctoral_synthesis",
        "output_type": "NARRATIVE",
        "external_handler": {
          "class": "DoctoralCarverSynthesizer",
          "module": "farfan_pipeline.phases. Phase_two.carver"
        }
      }
    ]
  },
  "fusion_specification": {
    "contract_type": "TYPE_B",
    "primary_strategy": "bayesian_update",
    "level_strategies": {
      "N1_fact_fusion": {
        "strategy": "concat",
        "behavior": "additive",
        "conflict_resolution": "preserve_all"
      },
      "N2_parameter_fusion": {
        "strategy": "bayesian_update",
        "behavior": "multiplicative",
        "conflict_resolution": "posterior_weighting",
        "affects": [
          "N1_facts. confidence",
          "posterior_distribution"
        ]
      },
      "N3_constraint_fusion": {
        "strategy": "veto_gate",
        "behavior": "gate",
        "asymmetry_principle": "audit_dominates",
        "propagation": {
          "upstream": "confidence_backpropagation",
          "downstream": "branch_blocking"
        }
      }
    },
    "fusion_pipeline": {
      "stage_1_fact_accumulation": {
        "input": "phase_A_construction. outputs",
        "operation": "BUILD evidence graph from detected gaps and remediations",
        "output": "evidence_graph_v1",
        "type_consumed": "FACT"
      },
      "stage_2_bayesian_update": {
        "input": [
          "evidence_graph_v1",
          "phase_B_computation.outputs"
        ],
        "operation": "UPDATE posterior beliefs using Bayesian inference",
        "output": "evidence_graph_v2_posterior",
        "type_consumed": "PARAMETER"
      },
      "stage_3_constraint_filtering": {
        "input": [
          "evidence_graph_v2_posterior",
          "phase_C_litigation.outputs"
        ],
        "operation": "FILTER/BLOCK branches that fail validation",
        "output": "evidence_graph_v3_validated",
        "type_consumed": "CONSTRAINT"
      },
      "stage_4_synthesis": {
        "input": "evidence_graph_v3_validated",
        "operation": "GENERATE narrative from validated graph",
        "output": "human_answer",
        "type_produced": "NARRATIVE"
      }
    }
  },
  "cross_layer_fusion": {
    "N1_to_N2": {
      "relationship": "N2 reads N1 facts",
      "effect": "N2 computes posterior FROM N1 observations",
      "data_flow": "forward_propagation"
    },
    "N2_to_N1": {
      "relationship": "N2 modifies N1 confidence",
      "effect": "Posterior updates adjust fact confidence",
      "data_flow": "confidence_backpropagation"
    },
    "N3_to_N1": {
      "relationship": "N3 can BLOCK N1 facts",
      "effect": "Failed constraints remove facts from graph",
      "data_flow": "veto_propagation",
      "asymmetry": "N1 CANNOT invalidate N3"
    },
    "N3_to_N2": {
      "relationship": "N3 can INVALIDATE N2 posteriors",
      "effect": "Failed constraints nullify Bayesian updates",
      "data_flow": "inference_modulation",
      "asymmetry": "N2 CANNOT invalidate N3"
    },
    "all_to_N4": {
      "relationship": "N4 consumes validated outputs from all layers",
      "effect": "Synthesis constructs narrative from filtered graph",
      "data_flow": "terminal_aggregation"
    },
    "blocking_propagation_rules": {
      "allocation_gap_detected": {
        "triggered_by": "FinancialAuditor._detect_allocation_gaps",
        "action": "reduce_confidence",
        "scope": "affected_goals",
        "propagation": "downstream_only"
      },
      "counterfactual_violation": {
        "triggered_by": "BayesianCounterfactualAuditor. counterfactual_query",
        "action": "block_branch",
        "scope": "causal_claims",
        "propagation": "both"
      }
    }
  },
  "human_answer_structure": {
    "format": "markdown",
    "template_mode": "epistemological_narrative",
    "contract_type": "TYPE_B",
    "sections": [
      {
        "section_id": "S1_verdict",
        "title": "### Veredicto",
        "layer": "N4",
        "data_source": "synthesis_output",
        "narrative_style": "declarative",
        "template": {
          "structure": [
            "**Conclusi\u00f3n**: {verdict_statement}",
            "",
            "**Confianza Global**: {final_confidence_pct}% ({confidence_label})",
            "",
            "**Base Metodol\u00f3gica**: {method_count} m\u00e9todos ejecutados, {audit_count} validaciones, {blocked_count} ramas bloqueadas."
          ]
        },
        "argumentative_role": "SYNTHESIS"
      },
      {
        "section_id": "S2_empirical_base",
        "title": "### Base Emp\u00edrica:  Hechos Observados",
        "layer": "N1",
        "data_source": "validated_facts",
        "narrative_style": "descriptive",
        "template": {
          "structure": [
            "**Gaps Detectados**: {gaps_count} brechas identificadas",
            "{gaps_list}",
            "",
            "**Remediaciones Propuestas**: {remediations_count}",
            "{remediations_list}"
          ]
        },
        "argumentative_role": "EMPIRICAL_BASIS",
        "epistemological_note": {
          "include_in_output": true,
          "text": "\ud83d\udccb *Nota:  Observaciones directas del documento fuente.*"
        }
      },
      {
        "section_id": "S3_robustness_audit",
        "title": "### An\u00e1lisis de Robustez:  Validaci\u00f3n y Limitaciones",
        "layer": "N3",
        "data_source": "audit_results",
        "narrative_style": "critical",
        "template": {
          "structure": [
            "{veto_alert}",
            "",
            "**Validaciones Ejecutadas**: {validation_count}",
            "",
            "**Gaps de Asignaci\u00f3n Financiera**: {allocation_gaps}",
            "",
            "**An\u00e1lisis Contrafactual**: {counterfactual_result}",
            "",
            "**Rendimiento del An\u00e1lisis**: {performance_assessment}",
            "",
            "**Limitaciones Metodol\u00f3gicas**:",
            "{limitations_list}"
          ]
        },
        "argumentative_role": "ROBUSTNESS_QUALIFIER",
        "veto_display": {
          "if_veto_triggered": "\u26d4 **MODELO INV\u00c1LIDO**:  {veto_reason}.  NO usar para toma de decisiones.",
          "if_partial_veto": "\u26a0\ufe0f **ROBUSTEZ PARCIAL**: {partial_veto_count} hallazgos invalidados.",
          "if_no_veto": "\u2705 **VALIDACI\u00d3N COMPLETA**:  Todos los hallazgos sobrevivieron refutaci\u00f3n."
        },
        "epistemological_note": {
          "include_in_output": true,
          "text": "\ud83d\udd2c *Nota:  Falsacionismo popperiano aplicado.*"
        }
      },
      {
        "section_id": "S4_gaps",
        "title": "### Puntos Ciegos:  Evidencia Faltante",
        "layer": "N4-META",
        "data_source": "gap_analysis",
        "narrative_style": "diagnostic",
        "template": {
          "structure": [
            "**M\u00e9todos sin Resultados**: {empty_methods_count} de {total_methods}",
            "{empty_methods_details}",
            "",
            "**Impacto en Confianza**:",
            "{gap_impact_assessment}"
          ]
        },
        "argumentative_role": "META_TRACEABILITY"
      }
    ],
    "argumentative_roles": {
      "N1_roles": [
        {
          "role": "EMPIRICAL_BASIS",
          "description": "Hecho observable",
          "narrative_weight": "high"
        }
      ],
      "N2_roles": [
        {
          "role": "INFERENTIAL_BRIDGE",
          "description": "Conexi\u00f3n bayesiana",
          "narrative_weight": "medium"
        }
      ],
      "N3_roles": [
        {
          "role": "ROBUSTNESS_QUALIFIER",
          "description": "Advertencia de limitaci\u00f3n",
          "narrative_weight": "high"
        },
        {
          "role": "FINANCIAL_CONSTRAINT",
          "description": "L\u00edmite presupuestal",
          "narrative_weight": "critical",
          "triggers_veto": true
        }
      ],
      "N4_roles": [
        {
          "role": "META_TRACEABILITY",
          "description": "Calidad del proceso",
          "narrative_weight": "medium"
        }
      ]
    },
    "confidence_interpretation": {
      "critical": {
        "range": [
          0,
          19
        ],
        "label": "INV\u00c1LIDO",
        "display": "\ud83d\udd34"
      },
      "low": {
        "range": [
          20,
          49
        ],
        "label": "D\u00c9BIL",
        "display": "\ud83d\udfe0"
      },
      "medium": {
        "range": [
          50,
          79
        ],
        "label": "MODERADO",
        "display": "\ud83d\udfe1"
      },
      "high": {
        "range": [
          80,
          100
        ],
        "label": "ROBUSTO",
        "display": "\ud83d\udfe2"
      }
    }
  },
  "output_contract": {
    "result_type": "Phase2QuestionResult",
    "schema": {
      "type": "object",
      "required": [
        "base_slot",
        "question_id",
        "evidence",
        "score",
        "human_answer"
      ],
      "properties": {
        "base_slot": {
          "type": "string",
          "const": "D1-Q2"
        },
        "question_id": {
          "type": "string"
        },
        "dimension_id": {
          "type": "string"
        },
        "policy_area_id": {
          "type": "string"
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "confidence_label": {
          "type": "string",
          "enum": [
            "INV\u00c1LIDO",
            "D\u00c9BIL",
            "MODERADO",
            "ROBUSTO"
          ]
        },
        "evidence": {
          "type": "object"
        },
        "human_answer": {
          "type": "string"
        },
        "epistemological_trace": {
          "type": "object"
        }
      }
    }
  },
  "validation_rules": {
    "na_policy": "abort_on_critical",
    "derivation_source": "expected_elements",
    "engine": "VALIDATION_ENGINE",
    "module": "farfan_pipeline. phases.Phase_two.evidence_nexus",
    "class_name": "ValidationEngine",
    "method_name": "validate"
  },
  "error_handling": {
    "on_method_not_found": "raise",
    "on_method_failure": "propagate_with_trace",
    "on_assembly_failure": "propagate_with_trace",
    "failure_contract": {
      "abort_if": [
        "missing_required_element",
        "incomplete_text"
      ],
      "emit_code": "ABORT-D1-Q2-REQ"
    }
  },
  "traceability": {
    "canonical_sources": {
      "questionnaire": "canonic_questionnaire_central/questionnaire_monolith.json",
      "method_inventory": "src/farfan_pipeline/phases/Phase_two/json_files_phase_two/method_classification_all_30.json",
      "epistemological_guide": "guia_diligenciamiento_contratos_v4.md"
    },
    "generation": {
      "method": "v4_epistemological_generation",
      "timestamp": "2025-12-22T00:00:00Z",
      "generator_version": "1.0.0"
    },
    "refactoring_history": [
      {
        "from_version": "3.0.0",
        "to_version": "4.0.0-epistemological",
        "date": "2025-12-22T00:00:00Z",
        "changes": [
          "Epistemological stratification",
          "Typed fusion",
          "Veto gates",
          "Bayesian update strategy"
        ],
        "epistemological_framework": {
          "N1": "Empirismo positivista",
          "N2": "Bayesianismo subjetivista",
          "N3": "Falsacionismo popperiano",
          "N4": "Reflexividad cr\u00edtica"
        }
      }
    ]
  },
  "compatibility": {
    "questionnaire_monolith_version": "3.0.0",
    "version_detection": "runtime",
    "minimum_requirements": {
      "signal_registry": "MicroAnsweringSignalPack support",
      "hydrator": "ContractHydrator v1.0.0",
      "carver": "DoctoralCarverSynthesizer v3.0.0",
      "evidence_nexus": "EvidenceNexus v2.0.0"
    }
  },
  "calibration": {
    "status": "runtime",
    "sources": {
      "intrinsic_calibration": "config/intrinsic_calibration.json",
      "fusion_specification": "config/fusion_specification.json"
    }
  }
}