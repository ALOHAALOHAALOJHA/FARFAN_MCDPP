<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtroZ ¬∑ Admin Control Center</title>
    <meta name="description" content="Panel de administraci√≥n del sistema F.A.R.F.A.N para an√°lisis de planes de desarrollo territorial">
    <link rel="stylesheet" href="css/atroz-dashboard.css">
</head>
<body role="application">
    <div class="neural-bg" aria-hidden="true"></div>
    <canvas id="particle-canvas" aria-hidden="true"></canvas>

    <div class="admin-container">
        <header class="admin-header" role="banner">
            <div>
                <div class="logo">ATROZ ADMIN</div>
                <p style="font-size: 10px; margin-top: 10px; opacity: 0.7; letter-spacing: 2px;">SISTEMA DE CONTROL Y AN√ÅLISIS</p>
            </div>
            <div style="display: flex; gap: 20px; align-items: center;">
                <div style="font-size: 10px; opacity: 0.7;">
                    <span id="adminUser" aria-label="Usuario administrador">ADMINISTRATOR</span> |
                    <span id="systemTime" aria-label="Hora del sistema" aria-live="polite">--:--:--</span>
                </div>
                <button class="btn-primary" onclick="location.href='index.html'" aria-label="Ir al dashboard principal">DASHBOARD</button>
            </div>
        </header>

        <main class="admin-grid" role="main">
            <!-- Upload Card -->
            <section class="admin-card" aria-labelledby="upload-title">
                <h2 id="upload-title">üìÑ Cargar Plan de Desarrollo</h2>
                <div class="upload-zone" id="uploadZone" role="button" tabindex="0" aria-label="Zona de carga de archivos PDF">
                    <p style="font-size: 12px; margin-bottom: 10px;">Arrastra el PDF aqu√≠ o haz clic para seleccionar</p>
                    <p style="font-size: 9px; opacity: 0.5;">Formatos soportados: PDF (m√°x. 50MB)</p>
                    <input type="file" id="pdfInput" accept=".pdf" style="display: none;" aria-label="Seleccionar archivo PDF">
                </div>
                <div id="fileInfo" style="margin-top: 20px; display: none;" aria-live="polite">
                    <p style="font-size: 10px; opacity: 0.7;">Archivo seleccionado:</p>
                    <p id="fileName" style="font-size: 11px; color: var(--atroz-green-toxic); margin-top: 5px;"></p>
                    <p id="fileSize" style="font-size: 9px; opacity: 0.5; margin-top: 5px;"></p>
                </div>
                <button class="btn-primary" id="runAnalysisBtn" style="width: 100%; margin-top: 20px;" disabled aria-label="Ejecutar an√°lisis completo del documento">
                    EJECUTAR AN√ÅLISIS COMPLETO
                </button>
                <div class="progress-bar" id="uploadProgress" style="display: none;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progreso de carga">
                    <div class="progress-fill" id="uploadProgressFill"></div>
                </div>
            </section>

            <!-- Pipeline Status Card -->
            <section class="admin-card" aria-labelledby="pipeline-status-title">
                <h2 id="pipeline-status-title">‚öôÔ∏è Estado del Pipeline</h2>
                <div id="pipelineStatus" style="margin-top: 20px;" role="status" aria-live="polite">
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Estado actual:</p>
                        <p id="currentStatus" style="font-size: 12px; color: var(--atroz-blue-electric); margin-top: 5px;">ESPERANDO DOCUMENTO</p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">√öltima ejecuci√≥n:</p>
                        <p id="lastRun" style="font-size: 11px; margin-top: 5px;">--</p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500);">
                        <p style="font-size: 10px; opacity: 0.7;">Tiempo estimado:</p>
                        <p id="estimatedTime" style="font-size: 11px; margin-top: 5px;">--</p>
                    </div>
                </div>
            </section>

            <!-- System Metrics Card -->
            <section class="admin-card" style="grid-column: 1 / -1;" aria-labelledby="system-metrics-title">
                <h2 id="system-metrics-title">üìä M√©tricas del Sistema</h2>
                <div class="metrics-grid" role="group" aria-label="M√©tricas del sistema">
                    <div class="metric-box">
                        <span class="metric-value" id="metricProcessed">0</span>
                        <span class="metric-label">Documentos Procesados</span>
                    </div>
                    <div class="metric-box">
                        <span class="metric-value" id="metricQuestions">0</span>
                        <span class="metric-label">Preguntas Analizadas</span>
                    </div>
                    <div class="metric-box">
                        <span class="metric-value" id="metricEvidence">0</span>
                        <span class="metric-label">Evidencias Extra√≠das</span>
                    </div>
                    <div class="metric-box">
                        <span class="metric-value" id="metricRecommendations">0</span>
                        <span class="metric-label">Recomendaciones</span>
                    </div>
                    <div class="metric-box">
                        <span class="metric-value" id="metricScore">--</span>
                        <span class="metric-label">Score Macro Promedio</span>
                    </div>
                    <div class="metric-box">
                        <span class="metric-value" id="metricUptime" aria-label="Tiempo de actividad del sistema">--</span>
                        <span class="metric-label">Uptime del Sistema</span>
                    </div>
                </div>
            </section>

            <!-- Health Monitor Card -->
            <section class="admin-card" aria-labelledby="health-monitor-title">
                <h2 id="health-monitor-title">üíö Monitor de Salud del Sistema</h2>
                <div style="margin-top: 20px;" role="group" aria-label="Indicadores de salud del sistema">
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 10px;">CPU</span>
                            <span id="cpuValue" style="font-size: 10px; color: var(--atroz-green-toxic);">--</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cpuBar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 10px;">MEMORIA</span>
                            <span id="memValue" style="font-size: 10px; color: var(--atroz-green-toxic);">--</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="memBar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 10px;">CACHE HIT RATE</span>
                            <span id="cacheValue" style="font-size: 10px; color: var(--atroz-green-toxic);">--</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cacheBar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 10px;">LATENCIA API</span>
                            <span id="latencyValue" style="font-size: 10px; color: var(--atroz-green-toxic);">--</span>
                        </div>
                        <div class="progress-bar" role="progressbar" aria-label="Latencia API">
                            <div class="progress-fill" id="latencyBar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Performance Metrics Card -->
            <section class="admin-card" aria-labelledby="performance-title">
                <h2 id="performance-title">‚ö° Rendimiento del Pipeline</h2>
                <div style="margin-top: 20px;">
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-green-toxic); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Fase 1-3 (Macro)</p>
                        <p style="font-size: 12px; color: var(--atroz-green-toxic); margin-top: 5px;">
                            <span id="perfMacro">--</span>s promedio
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-blue-electric); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Fase 4-7 (Meso)</p>
                        <p style="font-size: 12px; color: var(--atroz-blue-electric); margin-top: 5px;">
                            <span id="perfMeso">--</span>s promedio
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-oxide); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Fase 8-10 (Micro)</p>
                        <p style="font-size: 12px; color: var(--atroz-copper-oxide); margin-top: 5px;">
                            <span id="perfMicro">--</span>s promedio
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-red-500);">
                        <p style="font-size: 10px; opacity: 0.7;">Fase 11 (Reporte)</p>
                        <p style="font-size: 12px; color: var(--atroz-red-500); margin-top: 5px;">
                            <span id="perfReport">--</span>s promedio
                        </p>
                    </div>
                </div>
            </section>

            <!-- Console Log Card -->
            <section class="admin-card" style="grid-column: 1 / -1;" aria-labelledby="console-title">
                <h2 id="console-title">üìã Consola de Actividad</h2>
                <div class="log-console" id="logConsole" role="log" aria-live="polite" aria-label="Registro de actividad del sistema">
                    <div class="log-entry">
                        <span class="timestamp">[--:--:--]</span>
                        <span>Sistema inicializado. Esperando entrada...</span>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn-primary" onclick="clearLogs()" style="flex: 1;" aria-label="Limpiar registros de actividad">LIMPIAR LOGS</button>
                    <button class="btn-primary" onclick="exportLogs()" style="flex: 1;" aria-label="Exportar registros de actividad">EXPORTAR LOGS</button>
                    <button class="btn-primary" onclick="refreshMetrics()" style="flex: 1;" aria-label="Actualizar m√©tricas del sistema">ACTUALIZAR M√âTRICAS</button>
                </div>
            </section>

            <!-- Advanced Controls Card -->
            <section class="admin-card" aria-labelledby="advanced-controls-title">
                <h2 id="advanced-controls-title">üéõÔ∏è Controles Avanzados</h2>
                <div style="margin-top: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label for="logLevel" style="font-size: 10px; opacity: 0.7; display: block; margin-bottom: 5px;">NIVEL DE LOG</label>
                        <select id="logLevel" aria-label="Nivel de registro de eventos" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--atroz-copper-700); color: var(--ink); font-family: 'JetBrains Mono', monospace;">
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO" selected>INFO</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label for="phaseTimeout" style="font-size: 10px; opacity: 0.7; display: block; margin-bottom: 5px;">TIMEOUT FASES (segundos)</label>
                        <input type="number" id="phaseTimeout" value="300" min="60" max="600" aria-label="Tiempo m√°ximo de ejecuci√≥n por fase" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--atroz-copper-700); color: var(--ink); font-family: 'JetBrains Mono', monospace;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="font-size: 10px; opacity: 0.7; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="enableCache" checked aria-label="Habilitar sistema de cach√©">
                            HABILITAR CACHE
                        </label>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="font-size: 10px; opacity: 0.7; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="enableParallel" checked aria-label="Habilitar procesamiento paralelo">
                            PROCESAMIENTO PARALELO
                        </label>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()" style="width: 100%;" aria-label="Guardar configuraci√≥n del sistema">GUARDAR CONFIGURACI√ìN</button>
                </div>
            </section>

            <!-- Orchestrator Status Card -->
            <section class="admin-card" aria-labelledby="orchestrator-status-title">
                <h2 id="orchestrator-status-title">üîß Estado del Orchestrator</h2>
                <div style="margin-top: 20px;">
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Versi√≥n Calibraci√≥n:</p>
                        <p id="calibrationVersion" style="font-size: 11px; color: var(--atroz-green-toxic); margin-top: 5px;">--</p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">M√©todos Registrados:</p>
                        <p id="methodCount" style="font-size: 11px; margin-top: 5px;">--</p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500); margin-bottom: 10px;">
                        <p style="font-size: 10px; opacity: 0.7;">Preguntas Activas:</p>
                        <p id="questionCount" style="font-size: 11px; margin-top: 5px;">--</p>
                    </div>
                    <div style="padding: 15px; background: rgba(0,0,0,0.5); border-left: 3px solid var(--atroz-copper-500);">
                        <p style="font-size: 10px; opacity: 0.7;">√öltima Verificaci√≥n:</p>
                        <p id="lastVerification" style="font-size: 11px; margin-top: 5px;">--</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="loading-dna" id="loadingDNA" role="status" aria-live="polite" aria-label="Cargando">
        <div class="dna-strand">
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
        </div>
    </div>

    <div class="notification" id="notification" role="alert" aria-live="assertive">
        <div id="notificationMessage"></div>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"
            integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
            crossorigin="anonymous"></script>

    <!-- Application Scripts -->
    <script src="js/atroz-data-service.js"></script>
    <script src="js/admin-dashboard.js"></script>

    <script>
        // Initialize particle background
        function initParticles() {
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            for (let i = 0; i < 80; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 1,
                    speedX: Math.random() * 0.5 - 0.25,
                    speedY: Math.random() * 0.5 - 0.25,
                    color: `rgba(${Math.random() * 100 + 155}, ${Math.random() * 50 + 50}, ${Math.random() * 100 + 155}, ${Math.random() * 0.3 + 0.1})`
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < particles.length; i++) {
                    let p = particles[i];

                    p.x += p.speedX;
                    p.y += p.speedY;

                    if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                }

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Update system time
        function updateSystemTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-CO', { hour12: false });
            document.getElementById('systemTime').textContent = timeString;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initParticles();
            updateSystemTime();
            setInterval(updateSystemTime, 1000);
        });
    </script>
</body>
</html>
